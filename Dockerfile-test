FROM haskell:9.2.5

EXPOSE 80

WORKDIR /opt/app
RUN stack upgrade

COPY ./feedfarer.cabal ./stack.yaml /opt/app/
RUN stack --resolver lts-20.11 build --only-dependencies --no-library-profiling --fast

COPY . /opt/app/
RUN stack --resolver lts-20.11 build --fast

COPY /static /var/www/feedfarer-webui